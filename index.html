<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criador de Calend√°rio de Conte√∫do</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body className="bg-gray-100">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        // √çcones
        const Download = () => <span>‚¨áÔ∏è</span>;
        const Plus = () => <span>‚ûï</span>;
        const Trash2 = () => <span>üóëÔ∏è</span>;
        const CalendarDays = () => <span>üìÖ</span>;
        const Edit2 = () => <span>‚úèÔ∏è</span>;
        const Save = () => <span>üíæ</span>;
        const Database = () => <span>üíæ</span>;
        
        const CalendarCreator = () => {
          const [year, setYear] = useState(2026);
          const [month, setMonth] = useState(0);
          const [events, setEvents] = useState([]);
          const [colorOptions, setColorOptions] = useState([]);
          const [newEvent, setNewEvent] = useState({ day: '', text: '', color: '' });
          const [newCategory, setNewCategory] = useState({ label: '', color: '#3b82f6' });
          const [editingColor, setEditingColor] = useState(null);
          const [editLabel, setEditLabel] = useState('');
          const [editColorValue, setEditColorValue] = useState('');
          const [deletingCategory, setDeletingCategory] = useState(null);
          const [lastSaved, setLastSaved] = useState(null);
          const [eventStatuses, setEventStatuses] = useState({});
          const [companies, setCompanies] = useState([]);
          const [selectedCompany, setSelectedCompany] = useState(null);
          const [newCompanyName, setNewCompanyName] = useState('');
          const [editingCompany, setEditingCompany] = useState(null);
          const [editCompanyName, setEditCompanyName] = useState('');

          useEffect(() => {
            try {
              const savedCompanies = JSON.parse(localStorage.getItem('calendar_companies') || '[]');
              if (savedCompanies.length > 0) {
                setCompanies(savedCompanies);
                setSelectedCompany(savedCompanies[0].id);
              }
            } catch (error) {
              console.error('Erro ao carregar empresas:', error);
            }
          }, []);

          useEffect(() => {
            if (!selectedCompany) return;
            try {
              const companyData = JSON.parse(localStorage.getItem(`company_${selectedCompany}`) || '{}');
              setEvents(companyData.events || []);
              setColorOptions(companyData.categories || []);
              setEventStatuses(companyData.statuses || {});
              if (companyData.lastSaved) setLastSaved(new Date(companyData.lastSaved));
            } catch (error) {
              console.error('Erro ao carregar dados da empresa:', error);
            }
          }, [selectedCompany]);

          useEffect(() => {
            if (!selectedCompany || (events.length === 0 && colorOptions.length === 0 && Object.keys(eventStatuses).length === 0)) return;
            try {
              const companyData = {
                events: events,
                categories: colorOptions,
                statuses: eventStatuses,
                lastSaved: new Date().toISOString()
              };
              localStorage.setItem(`company_${selectedCompany}`, JSON.stringify(companyData));
              setLastSaved(new Date());
            } catch (error) {
              console.error('Erro ao salvar:', error);
            }
          }, [events, colorOptions, eventStatuses, selectedCompany]);

          const months = [
            'JANEIRO', 'FEVEREIRO', 'MAR√áO', 'ABRIL', 'MAIO', 'JUNHO',
            'JULHO', 'AGOSTO', 'SETEMBRO', 'OUTUBRO', 'NOVEMBRO', 'DEZEMBRO'
          ];

          const fullWeekDays = ['DOMINGO', 'SEGUNDA', 'TER√áA', 'QUARTA', 'QUINTA', 'SEXTA', 'S√ÅBADO'];

          const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
          const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();

          const toggleEventStatus = (eventIndex, status) => {
            const eventKey = `event_${eventIndex}`;
            setEventStatuses(prev => {
              const current = prev[eventKey];
              if (current === status) {
                const newStatuses = {...prev};
                delete newStatuses[eventKey];
                return newStatuses;
              } else {
                return {...prev, [eventKey]: status};
              }
            });
          };

          const getEventStatus = (eventIndex) => eventStatuses[`event_${eventIndex}`] || null;

          const getStatusColor = (originalColor, status) => {
            if (status === 'done') return '#22c55e'; // Verde
            if (status === 'late') return '#ef4444'; // Vermelho
            return originalColor;
          };

          const addCompany = () => {
            if (newCompanyName.trim()) {
              const id = Date.now().toString();
              const newCompany = { id, name: newCompanyName.trim() };
              const updatedCompanies = [...companies, newCompany];
              setCompanies(updatedCompanies);
              localStorage.setItem('calendar_companies', JSON.stringify(updatedCompanies));
              setSelectedCompany(id);
              setNewCompanyName('');
              localStorage.setItem(`company_${id}`, JSON.stringify({ events: [], categories: [], statuses: {}, lastSaved: new Date().toISOString() }));
            }
          };

          const removeCompany = (companyId) => {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso apagar√° a empresa e TODOS os eventos e categorias dela. Deseja realmente excluir esta empresa?')) {
              const updatedCompanies = companies.filter(c => c.id !== companyId);
              setCompanies(updatedCompanies);
              localStorage.setItem('calendar_companies', JSON.stringify(updatedCompanies));
              localStorage.removeItem(`company_${companyId}`);
              
              if (selectedCompany === companyId) {
                if (updatedCompanies.length > 0) {
                  setSelectedCompany(updatedCompanies[0].id);
                } else {
                  setSelectedCompany(null);
                  setEvents([]); 
                  setColorOptions([]); 
                  setEventStatuses({});
                }
              }
            }
          };

          const startEditCompany = (company) => { setEditingCompany(company.id); setEditCompanyName(company.name); };
          const saveEditCompany = () => {
            const updatedCompanies = companies.map(c => c.id === editingCompany ? { ...c, name: editCompanyName.trim() } : c );
            setCompanies(updatedCompanies);
            localStorage.setItem('calendar_companies', JSON.stringify(updatedCompanies));
            setEditingCompany(null); setEditCompanyName('');
          };
          const cancelEditCompany = () => { setEditingCompany(null); setEditCompanyName(''); };

          const getTextColor = (bgColor) => {
            const hex = bgColor.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;
            return brightness > 155 ? '#000000' : '#ffffff';
          };

          const addEvent = () => {
            const dayNum = parseInt(newEvent.day);
            const daysInCurrentMonth = getDaysInMonth(year, month);
            if (!newEvent.day || !newEvent.text || !newEvent.color) return alert('Preencha todos os campos!');
            if (dayNum < 1 || dayNum > daysInCurrentMonth) return alert(`Dia inv√°lido para ${months[month]}`);
            
            setEvents([...events, { ...newEvent, day: dayNum, month: month, year: year }]);
            setNewEvent({ day: '', text: '', color: colorOptions.length > 0 ? colorOptions[0].id : '' });
          };

          const removeEvent = (index) => setEvents(events.filter((_, i) => i !== index));

          const addCategory = () => {
            if (newCategory.label.trim()) {
              setColorOptions([...colorOptions, { id: Date.now().toString(), label: newCategory.label, color: newCategory.color }]);
              setNewCategory({ label: '', color: '#3b82f6' });
            }
          };

          const startEditCategory = (category) => { setEditingColor(category.id); setEditLabel(category.label); setEditColorValue(category.color); };
          const saveEditCategory = () => {
            setColorOptions(colorOptions.map(c => c.id === editingColor ? { ...c, label: editLabel, color: editColorValue } : c ));
            setEditingColor(null); setEditLabel(''); setEditColorValue('');
          };
          const cancelEdit = () => { setEditingColor(null); setEditLabel(''); setEditColorValue(''); };

          const removeCategory = (id) => {
            setColorOptions(prev => prev.filter(c => c.id !== id));
            setEvents(prev => prev.filter(e => e.color !== id));
            setDeletingCategory(null);
            if (editingColor === id) setEditingColor(null);
          };

          const clearAllData = () => {
            if (confirm('‚ö†Ô∏è Apagar TODOS os eventos e categorias desta empresa atual? (A empresa n√£o ser√° exclu√≠da, apenas os dados)')) {
              setEvents([]); setColorOptions([]); setEventStatuses({});
              
              const companyData = {
                events: [],
                categories: [],
                statuses: {},
                lastSaved: new Date().toISOString()
              };
              localStorage.setItem(`company_${selectedCompany}`, JSON.stringify(companyData));
            }
          };

          const exportData = () => {
            const dataStr = JSON.stringify({ events, categories: colorOptions, exportDate: new Date().toISOString() }, null, 2);
            const link = document.createElement('a');
            link.href = URL.createObjectURL(new Blob([dataStr], { type: 'application/json' }));
            link.download = `backup-dados-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
          };

          const getEventsForDay = (day) => events.filter(e => e.day === day && e.month === month && e.year === year);
          const getLegendItems = () => {
            const currentEvents = events.filter(e => e.month === month && e.year === year);
            const uniqueColors = [...new Set(currentEvents.map(e => e.color))];
            return colorOptions.filter(c => uniqueColors.includes(c.id));
          };

          // L√ìGICA DE AGRUPAMENTO POR SEMANAS
          const getWeeks = () => {
            const weeks = [];
            let currentWeek = new Array(7).fill(null);
            const daysInMonth = getDaysInMonth(year, month);
            let currentDayOfWeek = getFirstDayOfMonth(year, month);

            for (let day = 1; day <= daysInMonth; day++) {
              currentWeek[currentDayOfWeek] = day;
              currentDayOfWeek++;
              if (currentDayOfWeek === 7) {
                weeks.push(currentWeek);
                currentWeek = new Array(7).fill(null);
                currentDayOfWeek = 0;
              }
            }
            if (currentDayOfWeek > 0) weeks.push(currentWeek);
            return weeks;
          };

          const drawCalendarToCanvas = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            const weeks = getWeeks();
            const canvasWidth = 1920;
            const padding = 60;
            const contentWidth = canvasWidth - (padding * 2);
            const colWidth = contentWidth / 7;
            const eventHeight = 36;
            const eventSpacing = 8;
            
            // 1. CALCULAR ALTURA DIN√ÇMICA
            let totalHeight = padding + 60; // Titulo
            totalHeight += 80; // Cabe√ßalho dos dias da semana
            
            weeks.forEach(week => {
              totalHeight += 40; // Barra preta de n√∫meros
              let maxEventsInWeek = 0;
              week.forEach(day => {
                if (day) maxEventsInWeek = Math.max(maxEventsInWeek, getEventsForDay(day).length);
              });
              totalHeight += (maxEventsInWeek * (eventHeight + eventSpacing)) + 40; 
            });
            
            const legendItems = getLegendItems();
            totalHeight += legendItems.length > 0 ? 120 : 40;
            
            // Configurar Canvas com altura din√¢mica
            const finalHeight = Math.max(1080, totalHeight);
            canvas.width = canvasWidth;
            canvas.height = finalHeight;
            
            // Fundo Branco
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvasWidth, finalHeight);
            
            let currentY = padding;
            
            // CABE√áALHO PRINCIPAL
            const companyName = companies.find(c => c.id === selectedCompany)?.name || '';
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`${months[month]} ${year} ${companyName ? `| ${companyName.toUpperCase()}` : ''}`, padding, currentY + 40);
            
            currentY += 100;

            // DIAS DA SEMANA
            ctx.textAlign = 'center';
            fullWeekDays.forEach((day, i) => {
              const x = padding + (i * colWidth);
              const pillMargin = 10;
              
              ctx.fillStyle = '#000000';
              ctx.beginPath();
              ctx.roundRect(x + pillMargin, currentY, colWidth - (pillMargin * 2), 50, 25);
              ctx.fill();
              
              ctx.fillStyle = '#ffffff';
              ctx.font = 'bold 20px Arial';
              ctx.fillText(day, x + (colWidth / 2), currentY + 33);
            });
            
            currentY += 80;

            // DESENHAR SEMANAS
            weeks.forEach(week => {
              ctx.fillStyle = '#000000';
              ctx.beginPath();
              ctx.roundRect(padding, currentY, contentWidth, 36, 18);
              ctx.fill();
              
              ctx.fillStyle = '#ffffff';
              ctx.font = 'bold 22px Arial';
              ctx.textAlign = 'left';
              
              week.forEach((day, i) => {
                if (day) {
                  const x = padding + (i * colWidth);
                  ctx.fillText(day.toString(), x + 25, currentY + 25);
                }
              });
              
              currentY += 50;
              let maxWeekHeight = 0;
              
              week.forEach((day, i) => {
                if (!day) return;
                
                const dayEvents = getEventsForDay(day);
                let eventY = currentY;
                const x = padding + (i * colWidth);
                const eventMargin = 10;
                
                dayEvents.forEach(event => {
                  const color = colorOptions.find(c => c.id === event.color);
                  if (!color) return;
                  
                  const originalIndex = events.findIndex(e => e.day === event.day && e.text === event.text && e.color === event.color && e.month === event.month && e.year === event.year);
                  const status = getEventStatus(originalIndex);
                  const finalColor = getStatusColor(color.color, status);
                  const textColor = getTextColor(finalColor);
                  
                  const eventX = x + eventMargin;
                  const eventW = colWidth - (eventMargin * 2);
                  
                  ctx.fillStyle = finalColor;
                  ctx.beginPath();
                  ctx.roundRect(eventX, eventY, eventW, eventHeight, eventHeight / 2);
                  ctx.fill();
                  
                  ctx.fillStyle = textColor;
                  ctx.font = 'bold 16px Arial';
                  ctx.textAlign = 'center';
                  
                  let displayText = event.text;
                  if (status === 'done') displayText += ' ‚úì';
                  if (status === 'late') displayText += ' ‚ö†';
                  
                  const maxTextWidth = eventW - 30;
                  let finalText = displayText;
                  while (ctx.measureText(finalText).width > maxTextWidth && finalText.length > 3) {
                    finalText = finalText.slice(0, -4) + '...';
                  }
                  
                  ctx.fillText(finalText, eventX + (eventW / 2), eventY + 24);
                  
                  eventY += eventHeight + eventSpacing;
                });
                
                maxWeekHeight = Math.max(maxWeekHeight, eventY - currentY);
              });
              
              currentY += maxWeekHeight + 30; 
            });

            // LEGENDA NO RODAP√â
            if (legendItems.length > 0) {
              currentY += 20;
              ctx.fillStyle = '#000000';
              ctx.font = 'bold 24px Arial';
              ctx.textAlign = 'left';
              ctx.fillText('LEGENDA:', padding, currentY + 30);
              
              const itemsPerRow = 5;
              const itemWidth = (contentWidth - 150) / itemsPerRow;
              
              legendItems.forEach((item, idx) => {
                const row = Math.floor(idx / itemsPerRow);
                const col = idx % itemsPerRow;
                const itemX = padding + 140 + (col * (itemWidth + 10));
                const itemY = currentY + (row * 45);
                
                ctx.fillStyle = item.color;
                ctx.beginPath();
                ctx.roundRect(itemX, itemY, itemWidth, 36, 18);
                ctx.fill();
                
                ctx.fillStyle = getTextColor(item.color);
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                
                let label = item.label;
                while (ctx.measureText(label).width > itemWidth - 20 && label.length > 3) label = label.slice(0, -4) + '...';
                
                ctx.fillText(label, itemX + (itemWidth / 2), itemY + 24);
              });
            }
            
            return { canvas, finalHeight };
          };

          const exportAsImage = async () => {
            try {
              const { canvas } = drawCalendarToCanvas();
              canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                const companyName = companies.find(c => c.id === selectedCompany)?.name || 'empresa';
                link.download = `calendario-${companyName}-${months[month]}-${year}.png`;
                link.click();
                URL.revokeObjectURL(url);
              }, 'image/png', 1.0);
            } catch (error) {
              alert('Erro ao exportar imagem.');
            }
          };

          const exportAsPDF = async () => {
            try {
              if (!window.jspdf) {
                const scriptPDF = document.createElement('script');
                scriptPDF.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                document.head.appendChild(scriptPDF);
                await new Promise((resolve) => scriptPDF.onload = resolve);
              }
              const { canvas, finalHeight } = drawCalendarToCanvas();
              const imgData = canvas.toDataURL('image/png', 1.0);
              
              const pdf = new window.jspdf.jsPDF({
                orientation: finalHeight > 1920 ? 'portrait' : 'landscape',
                unit: 'px',
                format: [1920, finalHeight],
                compress: true
              });
              
              pdf.addImage(imgData, 'PNG', 0, 0, 1920, finalHeight, '', 'FAST');
              const companyName = companies.find(c => c.id === selectedCompany)?.name || 'empresa';
              pdf.save(`calendario-${companyName}-${months[month]}-${year}.pdf`);
            } catch (error) {
              alert('Erro ao exportar PDF.');
            }
          };

          // RENDERIZA√á√ÉO DA TELA (CALEND√ÅRIO VIRTUAL)
          const renderCalendarUI = () => {
            const weeks = getWeeks();
            return (
              <div className="bg-white rounded-xl shadow-2xl p-8 border border-gray-200">
                <div className="mb-8 border-b pb-4">
                  <h2 className="text-4xl font-black text-gray-900 uppercase tracking-tight">
                    {months[month]} {year} <span className="text-gray-400 font-medium">|</span> {companies.find(c => c.id === selectedCompany)?.name}
                  </h2>
                </div>

                {/* Cabe√ßalho dos Dias */}
                <div className="grid grid-cols-7 gap-4 mb-6">
                  {fullWeekDays.map(day => (
                    <div key={day} className="bg-black text-white text-center py-3 rounded-full font-bold text-sm tracking-wide shadow-md">
                      {day}
                    </div>
                  ))}
                </div>

                {/* Linhas das Semanas */}
                <div className="space-y-8">
                  {weeks.map((week, wIdx) => (
                    <div key={wIdx} className="flex flex-col">
                      {/* Barra de N√∫meros */}
                      <div className="bg-black rounded-full h-10 flex items-center px-4 mb-4 shadow-md">
                        {week.map((day, dIdx) => (
                          <div key={dIdx} className="flex-1 text-white font-bold text-lg px-2">
                            {day || ''}
                          </div>
                        ))}
                      </div>
                      
                      {/* Colunas de Eventos */}
                      <div className="grid grid-cols-7 gap-4">
                        {week.map((day, dIdx) => (
                          <div key={dIdx} className="flex flex-col gap-2 min-h-[60px]">
                            {day && getEventsForDay(day).map((event, eIdx) => {
                              const color = colorOptions.find(c => c.id === event.color);
                              if (!color) return null;
                              
                              const originalIndex = events.findIndex(e => e.day === event.day && e.text === event.text && e.color === event.color && e.month === event.month && e.year === event.year);
                              const status = getEventStatus(originalIndex);
                              const finalColor = getStatusColor(color.color, status);
                              const textColor = getTextColor(finalColor);
                              
                              return (
                                <div
                                  key={eIdx}
                                  style={{ backgroundColor: finalColor, color: textColor }}
                                  className="rounded-full px-4 py-2 text-xs font-bold text-center truncate shadow-sm transition-transform hover:scale-105 cursor-default"
                                  title={event.text}
                                >
                                  {event.text}
                                  {status === 'done' && <span className="ml-1">‚úì</span>}
                                  {status === 'late' && <span className="ml-1">‚ö†</span>}
                                </div>
                              );
                            })}
                          </div>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>

                {/* Legenda Visual */}
                {getLegendItems().length > 0 && (
                  <div className="mt-12 pt-6 border-t">
                    <h3 className="font-bold text-xl mb-4 text-gray-800">LEGENDA</h3>
                    <div className="flex flex-wrap gap-3">
                      {getLegendItems().map(item => (
                        <div key={item.id} style={{ backgroundColor: item.color, color: getTextColor(item.color) }} className="rounded-full px-6 py-2 text-sm font-bold shadow-sm">
                          {item.label}
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            );
          };

          return (
            <div className="min-h-screen bg-gray-100 p-4 md:p-8">
              <div className="max-w-7xl mx-auto space-y-6">
                
                {/* PAINEL DE CONTROLE */}
                <div className="bg-white rounded-xl p-6 shadow-md border border-gray-200">
                  <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                    <div>
                      <h1 className="text-3xl font-black flex items-center gap-3 text-gray-800">
                        <CalendarDays /> Criador de Calend√°rio Upli
                      </h1>
                      {lastSaved && <p className="text-xs text-gray-500 mt-2 flex items-center gap-1"><Database /> Auto-salvo: {lastSaved.toLocaleString('pt-BR')}</p>}
                    </div>
                    <div className="flex gap-2 w-full md:w-auto">
                      <button onClick={exportData} className="flex-1 md:flex-none bg-green-600 text-white rounded-lg px-4 py-2 text-sm font-bold hover:bg-green-700 transition flex items-center justify-center gap-2 shadow-sm"><Download /> Backup</button>
                      <button onClick={clearAllData} className="flex-1 md:flex-none bg-yellow-500 text-white rounded-lg px-4 py-2 text-sm font-bold hover:bg-yellow-600 transition flex items-center justify-center gap-2 shadow-sm" disabled={!selectedCompany} title="Limpar eventos da tela (Mant√©m a empresa)"><Trash2 /> Limpar Eventos</button>
                    </div>
                  </div>

                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    {/* COLUNA ESQUERDA: Empresas e Data */}
                    <div className="space-y-6">
                      <div className="bg-gray-50 p-5 rounded-xl border border-gray-200">
                        <h3 className="font-bold text-gray-800 mb-3 flex items-center gap-2">üè¢ Gerenciar Empresas</h3>
                        
                        {/* Adicionar Empresa */}
                        <div className="flex gap-2 mb-4">
                          <input type="text" placeholder="Nome da nova empresa..." value={newCompanyName} onChange={e => setNewCompanyName(e.target.value)} onKeyPress={e => e.key === 'Enter' && addCompany()} className="flex-1 border-2 border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 outline-none" />
                          <button onClick={addCompany} className="bg-gray-800 text-white rounded-lg px-4 font-bold hover:bg-black transition">Adicionar</button>
                        </div>
                        
                        {/* Lista de Empresas com bot√£o de Excluir */}
                        {companies.length > 0 && (
                          <div className="flex flex-col gap-2 mt-4 max-h-48 overflow-y-auto pr-2">
                            <label className="text-xs font-bold text-gray-500 uppercase">Empresas Cadastradas:</label>
                            {companies.map(company => (
                              <div key={company.id} className={`flex items-center justify-between border-2 rounded-lg p-2 transition ${selectedCompany === company.id ? 'border-blue-500 bg-blue-50' : 'border-gray-200 bg-white'}`}>
                                
                                {editingCompany === company.id ? (
                                  <div className="flex items-center gap-2 w-full">
                                    <input type="text" value={editCompanyName} onChange={e => setEditCompanyName(e.target.value)} className="flex-1 border-2 rounded px-2 py-1 text-sm outline-none" onKeyPress={e => e.key === 'Enter' && saveEditCompany()} />
                                    <button onClick={saveEditCompany} className="bg-green-600 text-white px-3 py-1 rounded text-sm font-bold">Salvar</button>
                                    <button onClick={cancelEditCompany} className="bg-gray-400 text-white px-3 py-1 rounded text-sm font-bold">Cancelar</button>
                                  </div>
                                ) : (
                                  <>
                                    <div 
                                      className="flex-1 font-bold cursor-pointer truncate" 
                                      onClick={() => setSelectedCompany(company.id)}
                                    >
                                      {company.name} {selectedCompany === company.id && <span className="text-blue-500 text-xs ml-2">(Selecionada)</span>}
                                    </div>
                                    <div className="flex items-center gap-1">
                                      <button onClick={() => startEditCompany(company)} className="text-blue-500 hover:text-blue-700 p-2 rounded hover:bg-blue-100 transition" title="Editar nome"><Edit2 /></button>
                                      
                                      {/* BOT√ÉO EXCLUIR EMPRESA EXPL√çCITO */}
                                      <button 
                                        onClick={() => removeCompany(company.id)} 
                                        className="text-white bg-red-500 hover:bg-red-700 px-3 py-1 rounded-md text-sm font-bold flex items-center gap-1 transition shadow-sm"
                                        title="Excluir esta empresa e tudo dentro dela"
                                      >
                                        <Trash2 /> Excluir
                                      </button>
                                    </div>
                                  </>
                                )}
                              </div>
                            ))}
                          </div>
                        )}
                      </div>

                      <div className="flex gap-4">
                        <div className="flex-1">
                          <label className="block text-sm font-bold text-gray-700 mb-2">M√™s</label>
                          <select value={month} onChange={e => setMonth(parseInt(e.target.value))} className="w-full border-2 border-gray-300 rounded-lg px-3 py-3 font-bold bg-white outline-none cursor-pointer">
                            {months.map((m, i) => <option key={i} value={i}>{m}</option>)}
                          </select>
                        </div>
                        <div className="flex-1">
                          <label className="block text-sm font-bold text-gray-700 mb-2">Ano</label>
                          <input type="number" value={year} onChange={e => setYear(parseInt(e.target.value) || 2026)} className="w-full border-2 border-gray-300 rounded-lg px-3 py-3 font-bold outline-none" />
                        </div>
                      </div>
                    </div>

                    {/* COLUNA DIREITA: Categorias e Eventos */}
                    <div className="space-y-6">
                      <div className="bg-blue-50 p-5 rounded-xl border border-blue-100">
                        <h3 className="font-bold text-blue-900 mb-3 flex items-center gap-2">üé® Categorias</h3>
                        <div className="flex gap-2 mb-4">
                          <input type="text" placeholder="Ex: REELS, DESIGN..." value={newCategory.label} onChange={e => setNewCategory({...newCategory, label: e.target.value})} className="flex-1 border-2 border-blue-200 rounded-lg px-3 py-2 outline-none focus:border-blue-500" />
                          <input type="color" value={newCategory.color} onChange={e => setNewCategory({...newCategory, color: e.target.value})} className="w-12 h-11 rounded cursor-pointer border-2 border-blue-200 p-0" />
                          <button onClick={addCategory} className="bg-blue-600 text-white rounded-lg px-4 font-bold hover:bg-blue-700 transition">Adicionar</button>
                        </div>
                        <div className="flex flex-wrap gap-2 max-h-32 overflow-y-auto">
                          {colorOptions.map(color => (
                            <div key={color.id} style={{backgroundColor: color.color, color: getTextColor(color.color)}} className="flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold shadow-sm">
                              {color.label}
                              <button onClick={() => removeCategory(color.id)} className="ml-1 hover:text-red-900 font-black" title="Remover Categoria">√ó</button>
                            </div>
                          ))}
                        </div>
                      </div>

                      <div className="bg-green-50 p-5 rounded-xl border border-green-100">
                        <h3 className="font-bold text-green-900 mb-3 flex items-center gap-2">üìå Adicionar Evento</h3>
                        <div className="flex gap-2">
                          <input type="number" placeholder="Dia" value={newEvent.day} onChange={e => setNewEvent({...newEvent, day: e.target.value})} className="w-20 border-2 border-green-200 rounded-lg px-2 py-2 text-center font-bold outline-none" />
                          <input type="text" placeholder="O que vai rolar?" value={newEvent.text} onChange={e => setNewEvent({...newEvent, text: e.target.value})} className="flex-1 border-2 border-green-200 rounded-lg px-3 py-2 outline-none focus:border-green-500" />
                        </div>
                        <div className="flex gap-2 mt-2">
                          <select value={newEvent.color} onChange={e => setNewEvent({...newEvent, color: e.target.value})} className="flex-1 border-2 border-green-200 rounded-lg px-3 py-2 outline-none font-bold bg-white">
                            <option value="">Escolha a categoria...</option>
                            {colorOptions.map(c => <option key={c.id} value={c.id}>{c.label}</option>)}
                          </select>
                          <button onClick={addEvent} disabled={!newEvent.color || !newEvent.text || !newEvent.day} className="bg-green-600 disabled:bg-gray-400 text-white rounded-lg px-6 font-bold hover:bg-green-700 transition shadow-sm">Postar</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* LISTA DE EVENTOS R√ÅPIDA (GERENCIAMENTO) */}
                  <div className="mt-8 border-t pt-6">
                    <h3 className="font-bold text-gray-800 mb-4">Gerenciar Posts Cadastrados ({events.filter(e => e.month === month && e.year === year).length})</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-48 overflow-y-auto pr-2">
                      {events.filter(e => e.month === month && e.year === year).sort((a,b) => a.day - b.day).map((event, idx) => {
                        const color = colorOptions.find(c => c.id === event.color);
                        if (!color) return null;
                        const originalIndex = events.findIndex(e => e.day === event.day && e.text === event.text && e.color === event.color && e.month === event.month && e.year === event.year);
                        const status = getEventStatus(originalIndex);
                        
                        return (
                          <div key={idx} className="bg-white border rounded-lg p-3 shadow-sm flex flex-col gap-2">
                            <div className="flex items-center gap-2">
                              <span className="bg-gray-200 text-gray-800 font-black text-xs px-2 py-1 rounded">D{event.day}</span>
                              <span style={{backgroundColor: color.color, color: getTextColor(color.color)}} className="text-xs font-bold px-2 py-1 rounded-full truncate flex-1">{event.text}</span>
                            </div>
                            <div className="flex justify-between items-center mt-1">
                              <div className="flex gap-1">
                                <button onClick={() => toggleEventStatus(originalIndex, 'done')} className={`px-2 py-1 rounded text-xs font-bold transition ${status === 'done' ? 'bg-green-600 text-white' : 'bg-green-100 text-green-700 hover:bg-green-200'}`}>‚úì Feito</button>
                                <button onClick={() => toggleEventStatus(originalIndex, 'late')} className={`px-2 py-1 rounded text-xs font-bold transition ${status === 'late' ? 'bg-red-600 text-white' : 'bg-red-100 text-red-700 hover:bg-red-200'}`}>‚ö† Atraso</button>
                              </div>
                              <button onClick={() => removeEvent(originalIndex)} className="text-red-500 hover:text-red-700 transition"><Trash2 /></button>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* BOT√ïES DE EXPORTA√á√ÉO */}
                  {selectedCompany && (
                    <div className="flex flex-col md:flex-row gap-4 mt-8 pt-6 border-t border-gray-200">
                      <button onClick={exportAsImage} className="flex-1 bg-gradient-to-r from-blue-600 to-blue-800 text-white rounded-xl px-6 py-4 flex items-center justify-center gap-3 hover:shadow-lg transition-transform transform hover:-translate-y-1 font-black text-lg">
                        <Download /> Baixar Imagem (Calend√°rio)
                      </button>
                      <button onClick={exportAsPDF} className="flex-1 bg-gradient-to-r from-purple-600 to-purple-800 text-white rounded-xl px-6 py-4 flex items-center justify-center gap-3 hover:shadow-lg transition-transform transform hover:-translate-y-1 font-black text-lg">
                        <Download /> Baixar PDF (Alta Qualidade)
                      </button>
                    </div>
                  )}
                </div>

                {/* √ÅREA DE PR√â-VISUALIZA√á√ÉO DO CALEND√ÅRIO */}
                {selectedCompany && renderCalendarUI()}

              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CalendarCreator />);
    </script>
</body>
</html>
